<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa Conceptual â€” Semilleros (VersiÃ³n Mejorada)</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body,#app{height:100%}

    body{
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 50%, #e0f7fa 100%);
      color: #0f172a;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    /* Header */
    .header{
      padding:40px 24px 18px;
      background:transparent;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      border-bottom:1px solid rgba(15,23,42,0.08);
    }
    .brand h1{
      font-size:30px;
      font-weight:800;
      color:#0b1220;
      text-align:center;
      letter-spacing:1px;
    }
    .brand p{
      font-size:18px;
      color:#475569;
      text-align:center;
    }

    .main{flex:1;display:flex;overflow:hidden;position:relative}
    .canvas-wrapper{flex:1;position:relative;padding:20px;overflow:hidden}
    svg#mapCanvas{width:100%;height:100%;display:block}

    /* Control bar */
    .control-bar{
      position:fixed;right:20px;bottom:20px;
      display:flex;gap:10px;align-items:center;z-index:80
    }
    .btn{
      background:rgba(255,255,255,0.9);
      border:1px solid rgba(15,23,42,0.06);
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 18px rgba(11,18,32,0.06);
      transition:transform .12s ease,box-shadow .12s ease;
    }
    .btn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(11,18,32,0.08)}
    .zoom-indicator{
      background:linear-gradient(180deg,rgba(255,255,255,0.8),rgba(255,255,255,0.7));
      padding:8px 10px;border-radius:10px;border:1px solid rgba(15,23,42,0.04);font-size:13px
    }

    /* Instructions */
  /* Caja de instrucciones */
.instructions {
  position: fixed;
  left: 20px;
  bottom: 20px;
  z-index: 90;
  max-width: 320px;
  border-radius: 14px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.55);
  backdrop-filter: blur(8px);
  box-shadow: 0 10px 30px rgba(11, 18, 32, 0.06);
  border: 1px solid rgba(11, 18, 32, 0.06);
  transition: all 0.4s ease;
}

.instructions .head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.instructions h3 {
  font-size: 14px;
  color: #0b1220;
}

.instructions p {
  font-size: 12px;
  color: #475569;
  margin-top: 6px;
}

.instructions ul {
  margin-top: 8px;
  font-size: 13px;
  color: #334155;
  list-style: none;
}

.instructions li {
  margin-bottom: 6px;
}

/* Estado minimizado */
.instructions.collapsed {
  width: 60px;
  height: 60px;
  padding: 0;
  border-radius: 50%;
  background: #22c55e; /* verde */
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
  cursor: pointer;
  animation: pulse 1.5s infinite;
}

/* Efecto de pulso */
@keyframes pulse {
  0% {
    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.6);
  }
  70% {
    box-shadow: 0 0 0 12px rgba(34, 197, 94, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
  }
}

/* Ocultar contenido cuando estÃ¡ colapsado */
.instructions.collapsed .head,
.instructions.collapsed ul {
  display: none;
}

/* Emoji de ayuda visible en modo colapsado */
.instructions::after {
  content: "";
}

.instructions.collapsed::after {
  content: "ðŸ’¡";
  font-size: 28px;
  color: white;
}


    /* Modal */
        .modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;padding:28px;z-index:120}
    .modal.active{display:flex}
    .modal-backdrop{position:absolute;inset:0;background:rgba(10,15,25,0.35);backdrop-filter: blur(3px)}
    .modal-card{
      position:relative;z-index:10;width:min(640px,96%);
      border-radius:18px;overflow:hidden;
      border:1px solid rgba(11,18,32,0.08);
      box-shadow:0 30px 60px rgba(11,18,32,0.15);
      background:linear-gradient(180deg,rgba(255,255,255,0.96),rgba(250,250,250,0.9));
      backdrop-filter: blur(6px);
      transform: translateY(20px);
      animation: fadeIn 0.3s ease forwards;
    }
    @keyframes fadeIn {
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header{
      padding:20px;cursor:grab;display:flex;align-items:center;gap:14px;
      background: linear-gradient(135deg, #ffbe0b 0%, #fb5607 40%, #8338ec 100%);
      color:#fff;
    }
    .modal-emoji{font-size:28px}
    .modal-title{font-weight:700;font-size:18px}
    .modal-body{
      padding:18px 24px 24px;
      color:#0f172a;font-size:15px;line-height:1.6;
    }
    .modal-body h4 {
      font-size:17px;
      font-weight:700;
      margin-bottom:8px;
      color:#0f172a;
      display:flex;align-items:center;gap:6px;
    }
    .modal-body p {
      margin-bottom:10px;
      color:#334155;
    }
    .modal-body ul {
      list-style:none;padding-left:14px;
    }
    .modal-body li {
      margin-bottom:6px;
      position:relative;
      padding-left:18px;
      color:#475569;
      font-size:14px;
    }
    .modal-body li::before {
      content:"ðŸŒ¿";
      position:absolute;
      left:0;
      top:0;
      font-size:13px;
    }
    .modal-footer {
      padding:14px 20px;
      display:flex;justify-content:flex-end;
    }
    .btn-primary {
      background:#0f172a;
      color:#fff;
      padding:10px 16px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      background:#1e293b;
      transform:scale(1.04);
    }
    .emoji-badge{font-size:16px}

    .connector-label{
      font-size:12px;fill:#334155;font-weight:600;
      transform: translateY(9px)
    }

    @media (max-width:720px){
      .instructions{max-width:90%;left:10px;bottom:10px}
      .control-bar{right:10px;bottom:10px}
    }
    .emoji-badge {
  font-size: 20px;
  pointer-events: none;
}

.node-shape {
  transition: transform 0.3s ease, filter 0.3s ease;
}

.node-shape:hover {
  filter: brightness(1.1);
}

  </style>
</head>
<body>
  <div id="app">
    <header class="header">
      <div class="brand">
        <h1>ðŸŒ¿ Semilleros de InvestigaciÃ³n</h1>
        <p>Mapa conceptual interactivo con diseÃ±o renovado</p>
      </div>
    </header>

    <main class="main">
      <div class="canvas-wrapper" id="canvasWrapper">
        <svg id="mapCanvas" viewBox="0 0 1100 700"></svg>
      </div>
    </main>

  <aside class="instructions" id="instructions">
  <div class="head">
    <div>
      <h3>Instrucciones</h3>
      <p>Pulsa los nodos para ver detalles. Usa los botones de zoom.</p>
    </div>
    <div>
      <button class="btn" id="minimizeBtn" title="Minimizar/Expandir">â€”</button>
    </div>
  </div>
  <ul style="margin-top:10px">
    <li><strong>Arrastrar:</strong> Mueve el mapa</li>
    <li><strong>Zoom:</strong> + / -</li>
    <li><strong>Nodos:</strong> Conceptos y subconceptos</li>
  </ul>
</aside>


    <div class="control-bar">
      <button class="btn" onclick="zoomIn()">âž•</button>
      <button class="btn" onclick="zoomOut()">âž–</button>
      <button class="btn" onclick="resetView()">â†º</button>
      <div class="zoom-indicator">Zoom: <span id="zoomPercent">100</span>%</div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-backdrop" id="modalBackdrop"></div>
      <div class="modal-card" id="modalCard">
        <div class="modal-header" id="modalHeader">
          <div class="modal-emoji" id="modalEmoji">ðŸŒ±</div>
          <div>
            <div class="modal-title" id="modalTitle">TÃ­tulo</div>
            <div style="font-size:13px;color:#475569" id="modalSubtitle"></div>
          </div>
        </div>
        <div class="modal-body"><p id="modalBody">Contenidoâ€¦</p></div>
        <div class="modal-footer"><button class="btn-primary" id="modalClose">Cerrar</button></div>
      </div>
    </div>
  </div>

  <script>
    const nodes = [
      { id: 'main', label: 'Semilleros de InvestigaciÃ³n', x: 500, y: 90, shape: 'rect', color: '#ffbe0b', emoji: 'ðŸŒ±', info: {
          title: 'Semilleros de InvestigaciÃ³n',
          description: 'Espacios de formaciÃ³n acadÃ©mica e investigativa que permiten incentivar la conformaciÃ³n de grupos acadÃ©micos para debatir y discutir problemas e ideas que aporten al trabajo investigativo.',
          details: [
            'Espacios autogestionados de formaciÃ³n',
            'Integrados por estudiantes, docentes e investigadores',
            'Fomentan el espÃ­ritu cientÃ­fico',
            'ConstrucciÃ³n colectiva de conocimiento',
            'Responden a exigencias de la sociedad'
          ]
        } },
      { id: 'caracteristicas', label: 'CaracterÃ­sticas', x: 200, y: 200, shape: 'oval', color: '#fb5607', emoji: 'âœ¨', info: {
     
                    title: 'CaracterÃ­sticas',
                    description: 'Los semilleros son espacios autogestionados que otorgan gran libertad de acciÃ³n a sus miembros para fomentar el espÃ­ritu cientÃ­fico.',
                    details: [
                        'Espacios autogestionados',
                        'InvestigaciÃ³n formativa',
                        'Trabajo en red',
                        'DiÃ¡logo y publicaciones',
                        'Estructura curricular definida',
                        'Libertad de acciÃ³n para sus miembros'
                    ]
                }
            },
      { id: 'objetivos', label: 'Origen e Historia', x: 500, y: 200, shape: 'oval', color: '#fb5607', emoji: 'ðŸŒ', info: {
                    title: 'Origen e Historia',
                    description: 'El movimiento de semilleros surge en Colombia en 1996 como estrategia para fomentar el quehacer cientÃ­fico dentro de las instituciones universitarias.',
                    details: [
                        'Surge en Colombia en 1996',
                        'Se expande a AmÃ©rica Latina',
                        'Adoptado por Ecuador, PerÃº, MÃ©xico y Venezuela',
                        'Inspirado en experiencias europeas',
                        'Estrategia para fortalecer producciÃ³n cientÃ­fica'
                    ]
                } },
      { id: 'impacto', label: 'Impacto CientÃ­fico', x: 800, y: 200, shape: 'oval', color: '#fb5607', emoji: 'ðŸ“Š', info: {
  title: 'Impacto CientÃ­fico',
  description: 'Los semilleros de investigaciÃ³n han contribuido significativamente al fortalecimiento de la cultura cientÃ­fica, la generaciÃ³n de nuevo conocimiento y la consolidaciÃ³n de comunidades acadÃ©micas en distintas Ã¡reas del saber.',
  details: [
    'Aumento en publicaciones cientÃ­ficas',
                        'Mejora en rankings Scimago',
                        'Colombia: 12,651 documentos (2018)',
                        'MÃ©xico: 81,742 documentos (2018)',
                        'FormaciÃ³n de nuevos investigadores',
                        'Reconocimiento internacional'
  ]
}
 },
      { id: 'estructura', label: 'Estructura Curricular', x: 110, y: 340, shape: 'oval', color: '#ff006e', emoji: 'ðŸ”¬', info: {
                    title: 'Estructura Curricular',
                    description: 'Desarrollo de proyectos de investigaciÃ³n, publicaciones cientÃ­ficas y participaciÃ³n en eventos acadÃ©micos.',
                    details: [
                        'Desarrollo de proyectos de investigaciÃ³n',
                        'PublicaciÃ³n de artÃ­culos cientÃ­ficos',
                        'ParticipaciÃ³n en congresos y seminarios',
                        'ConformaciÃ³n de redes cientÃ­ficas',
                        'Eventos regionales, nacionales e internacionales',
                        'PublicaciÃ³n de ensayos y libros'
                    ]
                }},
      { id: 'participantes', label: 'Participantes', x: 300, y: 340, shape: 'rect', color: '#ff006e', emoji: 'ðŸ‘¥',  info: {
                    title: 'Participantes',
                    description: 'Los semilleros estÃ¡n integrados por personas interesadas en hacer de la investigaciÃ³n su estilo de vida.',
                    details: [
                        'Estudiantes de pregrado',
                        'Estudiantes de postgrado',
                        'Docentes investigadores',
                        'Tutores y asesores',
                        'Personas motivadas por problemas del entorno'
                    ]
                } },
      { id: 'paises', label: 'ExpansiÃ³n en AmÃ©rica Latina', x: 500, y: 340, shape: 'rect', color: '#ff006e', emoji: 'ðŸŒŽ', info: {
                    title: 'PaÃ­ses Latinoamericanos',
                    description: 'ImplementaciÃ³n en varios paÃ­ses de AmÃ©rica Latina con diferentes niveles de desarrollo.',
                    details: [
                        'Colombia: 22 artÃ­culos - LÃ­der regional (5to lugar Scimago)',
                        'MÃ©xico: 15 artÃ­culos - Segundo lugar (81,742 documentos 2018)',
                        'Ecuador: 6 artÃ­culos - Crecimiento sostenido (6to lugar)',
                        'PerÃº: 3 artÃ­culos - En desarrollo (7mo lugar)',
                        'Venezuela: 4 artÃ­culos - Tendencia fluctuante'
                    ]
                } },
      { id: 'produccion', label: 'ProducciÃ³n CientÃ­fica', x: 700, y: 340, shape: 'oval', color: '#ff006e', emoji: 'ðŸ“š', info: {
    title: 'ðŸ“š ProducciÃ³n CientÃ­fica',
    description: 'Los semilleros de investigaciÃ³n impulsan la generaciÃ³n de conocimiento mediante la publicaciÃ³n de artÃ­culos, ponencias, libros y proyectos que contribuyen al desarrollo cientÃ­fico y acadÃ©mico de las instituciones.',
    details: [
      'PublicaciÃ³n de artÃ­culos en revistas acadÃ©micas y cientÃ­ficas',
      'ParticipaciÃ³n en congresos, simposios y ferias de investigaciÃ³n',
      'ProducciÃ³n de libros, capÃ­tulos y memorias investigativas',
      'DifusiÃ³n del conocimiento a nivel nacional e internacional',
      'Fortalecimiento de la visibilidad institucional y cientÃ­fica'
    ]
  }},
      { id: 'beneficios', label: 'Beneficios', x: 920, y: 340, shape: 'rect', color: '#ff006e', emoji: 'ðŸ†', info: {
                    title: ' Beneficios',
                    description: 'Desarrollo cientÃ­fico, formaciÃ³n investigativa y progreso socio-econÃ³mico de las naciones.',
                    details: [
                        'Desarrollo de competencias investigativas',
                        'Fortalecimiento de cultura cientÃ­fica',
                        'ReducciÃ³n de dependencia tecnolÃ³gica',
                        'InnovaciÃ³n y desarrollo industrial',
                        'TransformaciÃ³n social',
                        'Mejoramiento de calidad de vida'
                    ]
                }},
      { id: 'metodologia', label: 'MetodologÃ­a de Trabajo', x: 200, y: 480, shape: 'oval', color: '#8338ec', emoji: 'ðŸ”¬',   info: {
    title: ' MetodologÃ­a de Trabajo',
    description: 'Los semilleros de investigaciÃ³n emplean metodologÃ­as activas e interdisciplinarias que promueven el aprendizaje colaborativo, la creatividad y la aplicaciÃ³n prÃ¡ctica del conocimiento en la soluciÃ³n de problemas reales.',
    details: [
      'Aprendizaje basado en proyectos y problemas reales',
      'Trabajo colaborativo entre estudiantes y docentes',
      'IntegraciÃ³n de distintas Ã¡reas del conocimiento',
      'Uso de mÃ©todos cualitativos y cuantitativos',
      'PromociÃ³n de la innovaciÃ³n y la investigaciÃ³n aplicada'
    ]
  } },
      { id: 'desafios', label: 'DesafÃ­os', x: 500, y: 480, shape: 'rect', color: '#8338ec', emoji: 'âš ï¸', info:{
        title: 'DesafÃ­os de los Semilleros de InvestigaciÃ³n',
    description: 'A pesar de su impacto positivo, los semilleros enfrentan retos relacionados con la sostenibilidad, la financiaciÃ³n y la continuidad de los proyectos de investigaciÃ³n.',
    details: [
      'Limitaciones en el acceso a recursos econÃ³micos',
      'Dificultades para mantener la participaciÃ³n activa de los estudiantes',
      'Necesidad de mayor reconocimiento institucional',
      'Escasa articulaciÃ³n con redes nacionales e internacionales',
      'Retos en la publicaciÃ³n y visibilizaciÃ³n de resultados cientÃ­ficos'
    ]
      } },
      { id: 'perspectivas', label: 'Inversion en I+D', x: 800, y: 480, shape: 'oval', color: '#3a86ff', emoji: 'ðŸ’° ',  info: {
                    title: 'InversiÃ³n en I+D',
                    description: 'Los paÃ­ses de AmÃ©rica Latina han aumentado significativamente su inversiÃ³n en investigaciÃ³n y desarrollo en relaciÃ³n al PIB.',
                    details: [
                        'MÃ©xico, Colombia, Ecuador y PerÃº aumentaron gasto en I+D',
                        'Mayor parte de inversiÃ³n proviene del Estado',
                        'Recursos destinados a universidades pÃºblicas',
                        'Nuevos lineamientos y polÃ­ticas de financiamiento',
                        'Contrarrestar dependencia tecnolÃ³gica'
                    ]
                } }
    ];

    const connections = [
      { from: 'main', to: 'caracteristicas', label: 'posee' },
      { from: 'main', to: 'objetivos', label: 'busca' },
      { from: 'main', to: 'impacto', label: 'genera' },
      { from: 'caracteristicas', to: 'estructura', label: 'desarrolla' },
      { from: 'caracteristicas', to: 'participantes', label: 'integra' },
      { from: 'objetivos', to: 'paises', label: 'impulsa' },
      { from: 'objetivos', to: 'produccion', label: 'promueve' },
      { from: 'impacto', to: 'beneficios', label: 'permite' },
      { from: 'estructura', to: 'metodologia', label: 'aplica' },
      { from: 'participantes', to: 'produccion', label: 'generan' },
      { from: 'paises', to: 'desafios', label: 'enfrenta' },
      { from: 'produccion', to: 'beneficios', label: 'otorga' },
      { from: 'desafios', to: 'perspectivas', label: 'requiere' }
    ];

    let scale=1, panX=0, panY=0, isDragging=false, dragStartX=0, dragStartY=0;
    const svg=document.getElementById('mapCanvas'), wrapper=document.getElementById('canvasWrapper');

  function drawMap() {
  svg.innerHTML = '';
  const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
  const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
  marker.setAttribute('id', 'arrowhead');
  marker.setAttribute('markerWidth', '10');
  marker.setAttribute('markerHeight', '10');
  marker.setAttribute('refX', '8');
  marker.setAttribute('refY', '3');
  marker.setAttribute('orient', 'auto');
  const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  path.setAttribute('d', 'M0,0 L10,3 L0,6 Z');
  path.setAttribute('fill', '#94a3b8');
  path.setAttribute('opacity', '0.7');
  marker.appendChild(path);
  defs.appendChild(marker);
  svg.appendChild(defs);

  const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
  g.setAttribute('transform', `translate(${panX},${panY}) scale(${scale})`);

  // === DIBUJAR CONEXIONES ===
  connections.forEach(conn => {
    const a = nodes.find(n => n.id === conn.from), b = nodes.find(n => n.id === conn.to);
    if (!a || !b) return;
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', a.x);
    line.setAttribute('y1', a.y);
    line.setAttribute('x2', b.x);
    line.setAttribute('y2', b.y);
    line.setAttribute('stroke', '#cbd5e1');
    line.setAttribute('stroke-width', 2);
    line.setAttribute('marker-end', 'url(#arrowhead)');
    g.appendChild(line);

    const midX = (a.x + b.x) / 2, midY = (a.y + b.y) / 2;
    const t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    t.setAttribute('x', midX);
    t.setAttribute('y', midY - 8);
    t.setAttribute('text-anchor', 'middle');
    t.setAttribute('class', 'connector-label');
    t.textContent = conn.label;
    g.appendChild(t);
  });

  // === DIBUJAR NODOS ===
  nodes.forEach(node => {
    const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    group.setAttribute('transform', `translate(${node.x},${node.y})`);
    group.style.cursor = 'pointer';
    group.addEventListener('click', () => showModal(node));

    let width = 180, height = 84;
    let shapeEl;

    if (node.shape === 'circle') {
      shapeEl = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      shapeEl.setAttribute('r', 48);
    } else if (node.shape === 'oval') {
      shapeEl = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
      shapeEl.setAttribute('rx', 70);
      shapeEl.setAttribute('ry', 36);
    } else {
      shapeEl = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      shapeEl.setAttribute('x', -90);
      shapeEl.setAttribute('y', -42);
      shapeEl.setAttribute('width', 180);
      shapeEl.setAttribute('height', 84);
      shapeEl.setAttribute('rx', 12);
    }

    shapeEl.setAttribute('fill', node.color);
    shapeEl.setAttribute('class', 'node-shape');
    group.appendChild(shapeEl);

    // emoji centrado dentro del nodo
const emoji = document.createElementNS('http://www.w3.org/2000/svg', 'text');
emoji.textContent = node.emoji || '';
emoji.setAttribute('text-anchor', 'middle');
emoji.setAttribute('dominant-baseline', 'middle');
emoji.setAttribute('x', 0);
emoji.setAttribute('y', -25); // un poco mÃ¡s arriba del texto
emoji.setAttribute('class', 'emoji-badge');
group.appendChild(emoji);

    // Etiqueta centrada
    const fo = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
    fo.setAttribute('x', -width / 2);
    fo.setAttribute('y', -height / 2);
    fo.setAttribute('width', width);
    fo.setAttribute('height', height);
    const div = document.createElement('div');
    div.style.width = '100%';
    div.style.height = '100%';
    div.style.display = 'flex';
    div.style.alignItems = 'center';
    div.style.justifyContent = 'center';
    div.style.fontSize = '13px';
    div.style.fontWeight = '700';
    div.style.textAlign = 'center';
    div.style.color = '#071126';
    div.textContent = node.label;
    fo.appendChild(div);
    group.appendChild(fo);

    g.appendChild(group);
  });

  svg.appendChild(g);
}

drawMap(); // â† âœ… MUY IMPORTANTE: llama la funciÃ³n al cargar

      svg.innerHTML='';
      const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
      const marker=document.createElementNS('http://www.w3.org/2000/svg','marker');
      marker.setAttribute('id','arrowhead');marker.setAttribute('markerWidth','10');
      marker.setAttribute('markerHeight','10');marker.setAttribute('refX','8');
      marker.setAttribute('refY','3');marker.setAttribute('orient','auto');
      const path=document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('d','M0,0 L10,3 L0,6 Z');path.setAttribute('fill','#94a3b8');
      path.setAttribute('opacity','0.7');marker.appendChild(path);
      defs.appendChild(marker);svg.appendChild(defs);

      const g=document.createElementNS('http://www.w3.org/2000/svg','g');
      g.setAttribute('transform',`translate(${panX},${panY}) scale(${scale})`);

      connections.forEach(conn=>{
        const a=nodes.find(n=>n.id===conn.from), b=nodes.find(n=>n.id===conn.to);
        const line=document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1',a.x);line.setAttribute('y1',a.y);
        line.setAttribute('x2',b.x);line.setAttribute('y2',b.y);
        line.setAttribute('stroke','#cbd5e1');line.setAttribute('stroke-width',2);
        line.setAttribute('marker-end','url(#arrowhead)');
        g.appendChild(line);

        const midX=(a.x+b.x)/2, midY=(a.y+b.y)/2;
        const t=document.createElementNS('http://www.w3.org/2000/svg','text');
        t.setAttribute('x',midX);t.setAttribute('y',midY-8);
        t.setAttribute('text-anchor','middle');
        t.setAttribute('class','connector-label');
        t.textContent=conn.label;g.appendChild(t);
      });
    
  nodes.forEach(node => {
  const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
  group.setAttribute('transform', `translate(${node.x},${node.y})`);
  group.style.cursor = 'pointer';
  group.addEventListener('click', () => showModal(node));

  let width = 180, height = 84;

  // === SHAPE ===
  let shapeEl;
  if (node.shape === 'circle') {
    shapeEl = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    shapeEl.setAttribute('r', 48);
    width = height = 96;
  } else if (node.shape === 'oval') {
    shapeEl = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
    shapeEl.setAttribute('rx', 70);
    shapeEl.setAttribute('ry', 36);
    width = 140;
    height = 72;
  } else {
    shapeEl = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
    shapeEl.setAttribute('x', -90);
    shapeEl.setAttribute('y', -42);
    shapeEl.setAttribute('width', 180);
    shapeEl.setAttribute('height', 84);
    shapeEl.setAttribute('rx', 12);
  }

  shapeEl.setAttribute('fill', node.color);
  shapeEl.setAttribute('class', 'node-shape');
  group.appendChild(shapeEl);

  // === EMOJI dentro del nodo ===
  const emoji = document.createElementNS('http://www.w3.org/2000/svg', 'text');
  emoji.textContent = node.emoji || '';
  emoji.setAttribute('text-anchor', 'start');
  emoji.setAttribute('x', -width / 2 + 10);
  emoji.setAttribute('y', -height / 2 + 20);
  emoji.setAttribute('class', 'emoji-badge');
  group.appendChild(emoji);

  // === LABEL centrado ===
  const fo = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
  fo.setAttribute('x', -width / 2);
  fo.setAttribute('y', -height / 2);
  fo.setAttribute('width', width);
  fo.setAttribute('height', height);

  const div = document.createElement('div');
  div.style.width = '100%';
  div.style.height = '100%';
  div.style.display = 'flex';
  div.style.flexDirection = 'column';
  div.style.alignItems = 'center';
  div.style.justifyContent = 'center';
  div.style.fontSize = '13px';
  div.style.fontWeight = '700';
  div.style.textAlign = 'center';
  div.style.color = '#071126';
  div.style.lineHeight = '1.2';
  div.textContent = node.label;

  fo.appendChild(div);
  group.appendChild(fo);

  // === AnimaciÃ³n hover ===
  group.addEventListener('mouseenter', () => {
    group.style.transition = 'transform 0.3s ease';
    group.style.transform = 'scale(1.1)';
  });
  group.addEventListener('mouseleave', () => {
    group.style.transform = 'scale(1)';
  });

  g.appendChild(group);
});

svg.appendChild(g);

    function showModal(node){
      const modalBody=document.getElementById('modalBody');
      const info=node.info;
      document.getElementById('modalTitle').textContent=info.title;
      document.getElementById('modalEmoji').textContent=node.emoji;
      modalBody.innerHTML=`

        <p>${info.description}</p>
        <ul>${info.details.map(d=>`<li>${d}</li>`).join('')}</ul>
      `;
      document.getElementById('modal').classList.add('active');
    }
    function closeModal(){
      document.getElementById('modal').classList.remove('active');
    }

    document.getElementById('modalClose').addEventListener('click',closeModal);
    document.getElementById('modalBackdrop').addEventListener('click',closeModal);

    const instr = document.getElementById('instructions');
const minBtn = document.getElementById('minimizeBtn');
let collapsed = false;

minBtn.addEventListener('click', (e) => { e.stopPropagation();

  collapsed = !collapsed;

  if (collapsed) {
    instr.classList.add('collapsed');
  } else {
    instr.classList.remove('collapsed');
  }
});

// Permite expandir haciendo clic sobre el cÃ­rculo verde
instr.addEventListener('click', () => {
  if (collapsed) {
    collapsed = false;
    instr.classList.remove('collapsed');
  }
});


    function zoomIn(){scale=Math.min(scale+0.2,3);updateZoom();drawMap();}
    function zoomOut(){scale=Math.max(scale-0.2,0.6);updateZoom();drawMap();}
    function resetView(){scale=1;panX=0;panY=0;updateZoom();drawMap();}
    function updateZoom(){document.getElementById('zoomPercent').textContent=Math.round(scale*100);}
    wrapper.addEventListener('mousedown',e=>{if(e.target.closest('.node'))return;isDragging=true;dragStartX=e.clientX-panX;dragStartY=e.clientY-panY;});
    window.addEventListener('mousemove',e=>{if(isDragging){panX=e.clientX-dragStartX;panY=e.clientY-dragStartY;drawMap();}});
    window.addEventListener('mouseup',()=>isDragging=false);
    window.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();});

    updateZoom();drawMap();
  </script>
</body>
</html>
